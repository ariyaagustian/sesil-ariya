<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Undangan Pernikahan | Sesil & Ariya</title>

  <link rel="apple-touch-icon" sizes="180x180" href="public/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="public/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="public/favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="192x192" href="public/favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="public/favicon/android-chrome-512x512.png">
  <link rel="manifest" href="public/favicon/site.webmanifest">

  <!-- Google Font: Ovo -->
  <link href="https://fonts.googleapis.com/css2?family=Ovo&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config untuk font Ovo + palet monokrom
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            ovo: ['Ovo', 'serif'],
          },
          colors: {
            base: {
              50:'#fafafa',100:'#f5f5f5',200:'#e5e5e5',300:'#d4d4d4',400:'#a3a3a3',
              500:'#737373',600:'#525252',700:'#404040',800:'#262626',900:'#171717'
            }
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,0.08)'
          }
        }
      }
    }
  </script>

  <style>
    /* Efek grain halus untuk nuansa timeless */
    .grain:before {
      content: "";
      position: absolute; inset: 0;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="2"></feTurbulence><feColorMatrix type="saturate" values="0"></feColorMatrix><feComponentTransfer><feFuncA type="table" tableValues="0 0.05"></feFuncA></feComponentTransfer></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
      opacity: .2; pointer-events: none; mix-blend-mode: multiply;
    }
    @keyframes slideUpFade {
      0% {
        opacity: 0;
        transform: translateY(50px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUpFadeIn {
      0% { opacity: 0; transform: translateY(50px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUpFadeOut {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-50px); }
    }

    .splash-inner {
      animation: slideUpFadeIn 1s ease-out forwards;
    }

    .splash-hide {
      animation: slideUpFadeOut 0.8s ease-in forwards;
    }

    #wishList {
      max-height: 400px;       /* atur sesuai kebutuhan */
      overflow-y: auto;
      scrollbar-width: thin;   /* Firefox */
    }

    #wishList::-webkit-scrollbar {
      width: 6px;
    }
    #wishList::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
    }

  </style>
</head>
<body class="font-ovo text-base-900 bg-base-50">

  <!-- ================== SPLASH / LOADING ================== -->
  <div id="splash" class="fixed inset-0 z-50 flex items-center justify-center bg-base-900 text-base-50">
    <div class="splash-inner text-center px-8">
      <div class="mb-8">
        <!-- Add Image Logo -->
        <!-- Change color logo to white -->
        <img class="mx-auto h-24 w-24 md:h-32 md:w-32 object-contain invert brightness-0" 
            src="public/assets/S&A Logo.png" 
            alt="Logo" />
        <h1 class="text-3xl md:text-5xl tracking-wide">The Wedding of</h1>
        <p id="coupleNameSplash" class="mt-2 text-xl md:text-3xl">Sesil & Ariya</p>
        <p id="guestNameSplash" class="mt-2 text-base text-base-300"></p>
      </div>
      <div class="w-64 h-1 bg-base-700 rounded-full overflow-hidden mx-auto">
        <div id="progressBar" class="h-full w-0 bg-base-300 transition-all"></div>
      </div>
      <p id="progressText" class="mt-3 text-sm text-base-300">Menyiapkan kenangan… 0%</p>
      <button id="openBtn" class="mt-8 inline-flex items-center gap-2 px-6 py-3 rounded-full border border-base-300 text-base-50 hover:bg-base-800">
        Buka Undangan
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.5 4.5L21 12l-7.5 7.5M21 12H3"/></svg>
      </button>
    </div>
  </div>

  <!-- ================== AUDIO / BACKSOUND ================== -->
  <audio id="bgm" loop preload="auto" crossorigin="anonymous">
    <!-- Ganti URL ini dengan lagu Anda (format .mp3) -->
    <source src="public/assets/sampai+jadi+debu.mp3" type="audio/mp3">
    <!-- <source src="public/assets/sampai jadi debu.mp4" type="audio/mpeg"> -->
  </audio>

  <!-- Tombol musik floating -->
  <button id="musicToggle" class="hidden fixed bottom-4 right-4 z-40 rounded-full border border-base-300 bg-white/70 backdrop-blur px-4 py-2 text-sm shadow-soft hover:bg-white">
    ♬ Pause
  </button>

  <!-- ================== NAV (Sticky minimal) ================== -->
  <header class="fixed top-0 left-0 right-0 z-30 bg-white/70 backdrop-blur border-b border-base-200">
    <div class="mx-auto max-w-5xl px-4 py-3 flex items-center justify-between">
      <a href="#intro" class="tracking-wide">
        <!-- Add Image Logo -->
        <!-- Change color logo to white -->
        <img class="mx-auto h-14 w-14 md:h-16 md:w-16 object-contain" 
            src="public/assets/S&A Logo.png" 
            alt="Logo" />
      </a>
      <nav class="hidden md:flex gap-6 text-sm">
        <a href="#gallery" class="hover:opacity-70">Galeri</a>
        <a href="#countdown" class="hover:opacity-70">Hitung Mundur</a>
        <a href="#save" class="hover:opacity-70">Simpan Tanggal</a>
        <a href="#wishes" class="hover:opacity-70">Doa & Pesan</a>
      </nav>
      <a href="#save" class="text-xs md:text-sm underline">Simpan Tanggal</a>
    </div>
  </header>

  <!-- ================== HERO / INTRO ================== -->
  <section id="intro" class="relative pt-24">
    <div class="absolute inset-0 -z-10 grain"></div>
    <div class="mx-auto max-w-5xl px-4 py-16 md:py-24 text-center">
      <!-- Add Image Logo -->
      <!-- Change color logo to white -->
      <img class="mx-auto h-24 w-24 md:h-32 md:w-32 object-contain" src="public/assets/S&A Logo.png" alt="Logo" />
      <p class="uppercase tracking-[0.35em] text-xs md:text-sm text-base-400">Undangan Pernikahan</p>
      <h2 id="coupleName" class="mt-4 text-4xl md:text-6xl">Sesil & Ariya</h2>
      <p id="weddingDateText" class="mt-1 text-base md:text-lg">Minggu, 4 April 2026 · Sukabumi</p>
      <p class="mt-3 text-sm md:text-sm text-base-500">Dengan memohon rahmat dan ridho Allah SWT, kami mengundang Bapak/Ibu/Saudara/i untuk hadir dan memberikan doa restu pada acara pernikahan kami.</p>

      <!-- Cover visual -->
      <div class="mt-10 md:mt-14 aspect-[16/9] md:aspect-[21/9] w-full overflow-hidden rounded-2xl border border-base-200 shadow-soft">
        <!-- Video sekarang jalan di semua device -->
        <video id="coverVideo" class="w-full h-full object-cover" playsinline muted loop autoplay preload="auto" crossorigin="anonymous">
          <source src="public/assets/wedding-video.webm" type="video/webm">
          <!-- <source src="public/assets/wedding-video.mp4" type="video/mp4"> -->
          Browser Anda tidak mendukung video.
        </video>
      </div>

      <p id="guestNameHero" class="mt-8 text-sm text-base-500"></p>
      <div class="mt-6 flex items-center justify-center gap-4">
        <a href="#countdown" class="px-5 py-3 rounded-full border border-base-300 hover:bg-base-100 text-sm">Lihat Hitung Mundur</a>
        <a href="#save" class="px-5 py-3 rounded-full bg-base-900 text-base-50 hover:bg-base-800 text-sm">Simpan Tanggal</a>
      </div>
    </div>
  </section>

  <section id="doa-restu" class="relative">
    <div class="mx-auto max-w-5xl px-4 pb-16 md:pb-24 text-center">
      <!-- Ayat suci Al Quran (QS. Ar Ruum 21)  -->
      <p class="text-base-500">وَمِنۡ ءَايَٰتِهِۦٓ أَنۡ خَلَقَ لَكُم مِّنۡ أَنفُسِكُمۡ أَزۡوَٰجٗا لِّتَسۡكُنُوٓاْ إِلَيۡهَا وَجَعَلَ بَيۡنَكُم مَّوَدَّةٗ وَرَحۡمَةًۚ إِنَّ فِي ذَٰلِكَ لَأٓيَٰتٖ لِّقَوۡمٖ يَتَفَكَّرُونَ</p>
      <p class="mt-5 italic text-xs md:text-sm text-base-500">"Dan di antara tanda-tanda (kebesaran)-Nya ialah Dia menciptakan untukmu istri-istri dari jenismu sendiri, supaya kamu cenderung dan merasa tenteram kepadanya, dan dijadikan-Nya di antaramu rasa kasih dan sayang. Sesungguhnya pada yang demikian itu benar-benar terdapat tanda-tanda bagi kaum yang berpikir."</p>
      <p class="mt-2 text-sm md:text-sm text-base-500">[QS. Ar Rum - 21]</p>
    </div>
  </section>

  <!-- ================== COUNTDOWN ================== -->
  <section id="countdown" class="relative">
    <div class="mx-auto max-w-5xl px-4 py-16 md:py-24">
      <h3 class="text-2xl md:text-3xl text-center">Menuju Hari Bahagia</h3>
      <p class="text-center text-base-500 mt-2">Kami tak sabar merayakan bersama Anda</p>
      <div class="mt-8 grid grid-cols-4 gap-3 md:gap-6 text-center">
        <div class="rounded-xl border border-base-200 p-4 md:p-6">
          <div id="dd" class="text-3xl md:text-5xl">00</div>
          <div class="mt-1 text-xs md:text-sm text-base-500">Hari</div>
        </div>
        <div class="rounded-xl border border-base-200 p-4 md:p-6">
          <div id="hh" class="text-3xl md:text-5xl">00</div>
          <div class="mt-1 text-xs md:text-sm text-base-500">Jam</div>
        </div>
        <div class="rounded-xl border border-base-200 p-4 md:p-6">
          <div id="mm" class="text-3xl md:text-5xl">00</div>
          <div class="mt-1 text-xs md:text-sm text-base-500">Menit</div>
        </div>
        <div class="rounded-xl border border-base-200 p-4 md:p-6">
          <div id="ss" class="text-3xl md:text-5xl">00</div>
          <div class="mt-1 text-xs md:text-sm text-base-500">Detik</div>
        </div>
      </div>
    </div>
  </section>

<!-- ================== PROFILE COUPLE ================== -->
  <section id="profile-couple" class="relative">
    <div class="mx-auto max-w-5xl px-4 py-16 md:py-24">
      <div class="grid md:grid-cols-2 gap-8 items-center">
        <div class="rounded-2xl overflow-hidden border border-base-200 shadow-soft">
          <img alt="Bride & Groom" class="w-full h-full object-cover" src="https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=1600&auto=format&fit=crop"/>
        </div>
        <div class="text-center md:text-left">
          <h3 class="text-2xl md:text-3xl">Tentang Kami</h3>
          <!-- Divider kecil -->
          <div class="my-4">
            <div class="h-px w-24 bg-base-200 mx-auto md:mx-0"></div>
          </div>
          <p class="mt-3">
            <span class="text-xl">Sesil Marsely</span><br/>
            <span class="text-sm text-base-500 italic">Putri pertama dari</span><br/>
            <span class="text-md">Bapak Surya Iskandar & Ibu Elli Chairani Siregar</span>
          </p>
          <p class="mt-5">
            <span class="text-xl">Ariya Agustian Riyadhi</span><br/>
            <span class="text-sm text-base-500 italic">Putra pertama dari</span><br/>
            <span class="text-md">Bapak Mamat Rachmat Riyadhi & Ibu Minarti</span>
          </p>
          <div class="my-4">
            <div class="h-px w-24 bg-base-200 mx-auto md:mx-0"></div>
          </div>
          <!-- Penutup (berbeda dari header, tidak mengulang “dengan memohon…”) -->
          <p class="mx-auto max-w-3xl mt-6 text-sm text-base-600 leading-relaxed">
            Kami memohon doa terbaik agar langkah kami senantiasa diberi kemudahan,
            keberkahan, dan kebahagiaan. Kehadiran serta restu Bapak/Ibu/Saudara/i
            menjadi pelengkap kebahagiaan kami.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- ================== SAVE THE DATE ================== -->
  <section id="save" class="relative">
    <div class="mx-auto max-w-5xl px-4 py-16 md:py-24">
      <div class="grid md:grid-cols-2 gap-8 items-center">
        <div>
          <h3 class="text-xl md:text-3xl">Tanggal & Tempat Acara</h3>
          <p id="saveVenueText" class="mt-3 text-base-700">Gedung Auditorium BBPBAT, Sukabumi</p>
          <p id="saveDateText" class="mt-1 text-base-500">Minggu, 5 April 2026 · 11.00 WIB</p>
          <div class="mt-6 flex flex-wrap gap-3">
            <button id="addCalendarBtn" class="px-5 py-3 rounded-full bg-base-900 text-base-50 hover:bg-base-800 text-sm">Tambah ke Kalender</button>
            <a id="mapBtn" target="_blank" rel="noopener" class="px-5 py-3 rounded-full border border-base-300 hover:bg-base-100 text-sm" href="https://maps.google.com?q=Gedung+Auditorium+BBPBAT">Lihat Peta</a>
          </div>
        </div>
        <div class="rounded-2xl overflow-hidden border border-base-200 shadow-soft">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3960.839955912496!2d106.93121677570625!3d-6.909732193089708!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6849caf6c6a9b9%3A0x6bff27d067a90702!2sGedung%20Auditorium%20BBPBAT!5e0!3m2!1sid!2sid!4v1757305961000!5m2!1sid!2sid" width="600" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
          <!-- <img alt="Venue" class="w-full h-full object-cover" src="https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=1600&auto=format&fit=crop"/> -->
        </div>
      </div>
    </div>
  </section>

  <!-- ================== GALLERY ================== -->
  <section id="gallery" class="relative">
    <div class="mx-auto max-w-5xl px-4 py-16 md:py-24">
      <h3 class="text-2xl md:text-3xl text-center">Galeri Foto</h3>
      <p class="text-center text-base-500 mt-2">Potongan kisah kami</p>
      <div id="galleryGrid" class="mt-8 grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4">
        <!-- Ganti sumber gambar sesuai kebutuhan -->
        <img class="gallery-img cursor-pointer rounded-xl border border-base-200 object-cover aspect-square" src="https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=800&auto=format&fit=crop" alt="galeri 1"/>
        <img class="gallery-img cursor-pointer rounded-xl border border-base-200 object-cover aspect-square" src="https://images.unsplash.com/photo-1512428559087-560fa5ceab42?q=80&w=800&auto=format&fit=crop" alt="galeri 2"/>
        <img class="gallery-img cursor-pointer rounded-xl border border-base-200 object-cover aspect-square" src="https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?q=80&w=800&auto=format&fit=crop" alt="galeri 3"/>
        <img class="gallery-img cursor-pointer rounded-xl border border-base-200 object-cover aspect-square" src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=800&auto=format&fit=crop" alt="galeri 4"/>
        <img class="gallery-img cursor-pointer rounded-xl border border-base-200 object-cover aspect-square" src="https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=800&auto=format&fit=crop" alt="galeri 5"/>
        <img class="gallery-img cursor-pointer rounded-xl border border-base-200 object-cover aspect-square" src="https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=800&auto=format&fit=crop" alt="galeri 6"/>
      </div>
    </div>
  </section>

  <!-- Lightbox sederhana -->
  <div id="lightbox" class="hidden fixed inset-0 z-50 bg-black/90 p-4 md:p-10">
    <button id="lightboxClose" class="absolute top-4 right-4 text-white text-2xl">×</button>
    <img id="lightboxImg" class="mx-auto max-h-[90vh] object-contain" src="" alt="preview"/>
  </div>

  <!-- ================== WISHES (Doa & Pesan) ================== -->
  <section id="wishes" class="relative">
    <div class="mx-auto max-w-3xl px-4 py-16 md:py-24">
      <h3 class="text-2xl md:text-3xl text-center">Doa & Pesan</h3>
      <p class="text-center text-base-500 mt-2">Tinggalkan ucapan untuk kami</p>

      <form id="wishForm" class="mt-8 grid md:grid-cols-[1fr_auto] gap-3">
        <input id="wishName" type="text" placeholder="Nama Anda" class="w-full border border-base-300 rounded-xl px-4 py-3 bg-white/70 backdrop-blur" required />
        <div class="md:col-span-2 grid md:grid-cols-[1fr_auto] gap-3">
          <input id="wishMsg" type="text" placeholder="Tulis doa & pesan…" class="w-full border border-base-300 rounded-xl px-4 py-3 bg-white/70 backdrop-blur" required />
          <button class="px-5 py-3 rounded-xl bg-base-900 text-base-50 hover:bg-base-800">Kirim</button>
        </div>
      </form>

      <div id="wishList" class="mt-8 space-y-4 max-h-96 overflow-y-auto pr-2">
        <!-- Pesan tampil di sini -->
      </div>
    </div>
  </section>

  <!-- ================== GIFTS (Hadiah) ================== -->
  <section id="gifts" class="relative">
    <div class="mx-auto max-w-3xl px-4 py-16 md:py-24 text-center">
      <h3 class="text-2xl md:text-3xl">Hadiah</h3>
      <p class="text-base-500 mt-2">
        Kehadiran Anda sudah merupakan hadiah terindah bagi kami. Namun, jika Anda berkenan memberikan hadiah, berikut nomor rekening kami
      </p>

      <div class="mt-8 grid md:grid-cols-2 gap-6">
        <!-- Card 1 -->
        <div class="p-6 rounded-xl border border-base-200 bg-white/80 backdrop-blur shadow-soft text-left relative">
          <div class="text-sm text-base-500">Bank BCA</div>
          <div class="font-semibold text-lg" id="rek1">3770339650</div>
          <div class="text-sm">a.n. Sesil Marsely</div>
          <button onclick="copyRek('rek1')" class="absolute top-4 right-4 text-xs px-3 py-1 rounded-full border border-base-300 hover:bg-base-100">
            Salin
          </button>
        </div>

        <!-- Card 2 -->
        <div class="p-6 rounded-xl border border-base-200 bg-white/80 backdrop-blur shadow-soft text-left relative">
          <div class="text-sm text-base-500">Bank BCA</div>
          <div class="font-semibold text-lg" id="rek2">1570236942</div>
          <div class="text-sm">a.n. Ariya Agustian Riyadhi</div>
          <button onclick="copyRek('rek2')" class="absolute top-4 right-4 text-xs px-3 py-1 rounded-full border border-base-300 hover:bg-base-100">
            Salin
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- ================== FOOTER ================== -->
  <footer class="border-t border-base-200">
    <div class="mx-auto max-w-5xl px-4 py-8 text-center text-sm text-base-500">
      Terima kasih atas doa restunya. — <span id="footerCouple">Sesil & Ariya</span>
    </div>
  </footer>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-5 right-5 bg-base-900 text-base-50 text-sm px-4 py-2 rounded-lg shadow-soft opacity-0 pointer-events-none transition duration-300">
    Nomor rekening berhasil disalin!
  </div>

  <!-- ================== SCRIPT ================== -->
  <script>

    // ========== CONFIG ==========
    const WEBHOOK_BASE = 'https://n8n.salam-homecare.com/webhook';
    const WISHES_ENDPOINT = `${WEBHOOK_BASE}/88b433aa-dcca-4e9a-b990-a72fed919ca2/doa-pesan`; // GET & POST endpoint yang kita buat di n8n

    // ====== KONFIGURASI ======
    const DISABLE_MUSIC = false; // Musik dimatikan sementara
    const config = {
      coupleName: 'Sesil & Ariya',
      dateISO: '2026-04-05T11:00:00+07:00', // Waktu acara (WIB)
      dateISOAkad: '2026-04-05T08:00:00+07:00', // Waktu resepsi (WIB), opsional
      venue: 'Gedung Auditorium BBPBAT, Sukabumi',
      city: 'Sukabumi',
      mapQuery: 'Gedung Auditorium BBPBAT',
      assetsToPreload: [
        'https://images.unsplash.com/photo-1511285560929-80b456fea0bc?q=80&w=1600&auto=format&fit=crop',
        'https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=1600&auto=format&fit=crop',
      ]
    };

    // ====== UTIL ======
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => [...el.querySelectorAll(s)];

    function formatDateLong(iso){
      const d = new Date(iso);
      return d.toLocaleDateString('id-ID', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    }

    // Ambil parameter ?to=Nama+Tamu
    const params = new URLSearchParams(location.search);
    const guest = params.get('to') || '';

    // ====== INITIAL TEXT ======
    function applyTexts(){
      qs('#coupleName').textContent = config.coupleName;
      qs('#coupleNameSplash').textContent = config.coupleName;
      qs('#footerCouple').textContent = config.coupleName;
      qs('#weddingDateText').textContent = `${formatDateLong(config.dateISO)} · ${config.city}`;
      qs('#saveDateText').innerHTML = `
        ${formatDateLong(config.dateISO)} <br/>
        ${new Date(config.dateISOAkad).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'})} WIB (Akad) <br/>
        ${new Date(config.dateISO).toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit'})} WIB (Resepsi)
      `;
      qs('#saveVenueText').textContent = config.venue;
      qs('#mapBtn').href = `https://maps.google.com?q=${config.mapQuery}`;
      if(guest){
        qs('#guestNameSplash').textContent = `Untuk: ${guest}`;
        const h = qs('#guestNameHero');
        h.textContent = `Kepada ${guest}, kehormatan bagi kami bila Anda berkenan hadir.`;
      }
    }

    // ====== PRELOADER (non-blocking) ======
    function preloadAssets(urls){
      let loaded = 0;
      const total = urls.length;
      const bar = qs('#progressBar');
      const text = qs('#progressText');
      return Promise.all(urls.map(url => new Promise(resolve=>{
        const isVideo = /\.(mp4|webm|ogg)$/i.test(url);
        const isAudio = /\.(mp3|wav|ogg)$/i.test(url);
        if(isVideo){
          const v = document.createElement('video');
          v.src = url; v.preload = 'auto';
          v.oncanplaythrough = done; v.onerror = done;
        } else if(isAudio){
          const a = document.createElement('audio');
          a.src = url; a.preload = 'auto';
          a.oncanplaythrough = done; a.onerror = done;
        } else {
          const img = new Image();
          img.src = url; img.onload = done; img.onerror = done;
        }
        function done(){
          loaded++; const pct = Math.round(loaded/total*100);
          if(bar) bar.style.width = pct + '%';
          if(text) text.textContent = `Menyiapkan kenangan… ${pct}%`;
          resolve();
        }
      })))
    }

    // ====== OPEN INVITATION ======
    function handleOpen(){
      const splash = document.querySelector('#splash');
      // kasih animasi keluar
      splash.classList.add('splash-hide');

      // tunggu animasi selesai lalu benar-benar sembunyikan
      setTimeout(()=> splash.style.display = 'none', 800);
      
      const audio = qs('#bgm');
      // Musik dimatikan sementara agar tidak bikin macet
      if (!DISABLE_MUSIC) {
        const p = audio.play();
        if (p && typeof p.catch === 'function') p.catch(()=>{});
        qs('#musicToggle').classList.remove('hidden');
      }
      // Mulai video cover pada desktop
      const v = qs('#coverVideo');
      if(v){ v.play && v.play().catch(()=>{}); }

    }

    // ====== COUNTDOWN ======
    function startCountdown(){
      const end = new Date(config.dateISO).getTime();
      function tick(){
        const now = Date.now();
        let diff = Math.max(0, end - now);
        const d = Math.floor(diff / (1000*60*60*24));
        diff -= d*(1000*60*60*24);
        const h = Math.floor(diff / (1000*60*60));
        diff -= h*(1000*60*60);
        const m = Math.floor(diff / (1000*60));
        diff -= m*(1000*60);
        const s = Math.floor(diff / 1000);
        qs('#dd').textContent = String(d).padStart(2,'0');
        qs('#hh').textContent = String(h).padStart(2,'0');
        qs('#mm').textContent = String(m).padStart(2,'0');
        qs('#ss').textContent = String(s).padStart(2,'0');
      }
      tick();
      setInterval(tick, 1000);
    }

    // ====== ADD TO CALENDAR (.ics) ======
    function downloadICS(){
      const d = new Date(config.dateISO);
      const dtStart = d.toISOString().replace(/[-:]/g,'').split('.')[0];
      const dtEnd = new Date(d.getTime()+2*60*60*1000).toISOString().replace(/[-:]/g,'').split('.')[0];
      const ics = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Undangan Pernikahan//ID\nBEGIN:VEVENT\nUID:${Date.now()}@Sesil&Ariya\nDTSTAMP:${dtStart}Z\nDTSTART:${dtStart}Z\nDTEND:${dtEnd}Z\nSUMMARY:Pernikahan ${config.coupleName}\nLOCATION:${config.venue}\nDESCRIPTION:Merayakan hari bahagia ${config.coupleName}.\nEND:VEVENT\nEND:VCALENDAR`;
      const blob = new Blob([ics], { type:'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'save-the-date.ics'; a.click();
      URL.revokeObjectURL(url);
    }

    // ====== WISHES (LocalStorage) ======
    // ========== WISHES (GET dari n8n + fallback localStorage) ==========
    async function loadWishes() {
      try {
        const res = await fetch(WISHES_ENDPOINT, { method: 'GET' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        // Payload = array langsung
        const rows = await res.json();

        const list = rows.map(r => ({
          ts: Date.parse(r.timestamp) || Date.now(),
          name: r.name ?? '',
          msg:  r.message ?? ''
        }));

        localStorage.setItem('wishes_cache', JSON.stringify(list));
        renderWishes(list);
      } catch (err) {
        console.warn('loadWishes error:', err);
        localStorage.setItem('wishes_cache', JSON.stringify([]));
        const cached = JSON.parse(localStorage.getItem('wishes_cache') || '[]');
        renderWishes(cached);
      }
    }


    function renderWishes(list){
      const wrap = qs('#wishList');
      if (!wrap) return;
      wrap.innerHTML = '';
      list.slice(-50).reverse().forEach(item=>{
        const el = document.createElement('div');
        el.className = 'border border-base-200 rounded-xl p-4 bg-white/70 backdrop-blur';
        el.innerHTML = `
          <div class="text-sm text-base-500">${new Date(item.ts).toLocaleString('id-ID')}</div>
          <div class="mt-1 font-semibold">${item.name}</div>
          <div class="mt-1">${item.msg}</div>`;
        wrap.appendChild(el);
      });
    }


    // ========== WISHES (POST ke n8n + fallback localStorage) ==========
    let lastSubmitAt = 0;
    async function submitWish(e){
      e.preventDefault();
      const name = qs('#wishName')?.value.trim();
      const msg  = qs('#wishMsg')?.value.trim();
      if(!name || !msg) return;

      // Anti-spam sederhana (5 detik)
      const now = Date.now();
      if (now - lastSubmitAt < 5000) return;
      lastSubmitAt = now;

      // Optimistic UI
      const optimistic = { name, msg, ts: now };
      const current = JSON.parse(localStorage.getItem('wishes_cache')||'[]');
      const next = [...current, optimistic];
      renderWishes(next);

      try {
        const res = await fetch(WISHES_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({ name, message: msg })
        });
        const data = await res.json().catch(()=>({}));
        if (!res.ok || data?.ok === false) throw new Error(data?.message || 'Gagal menyimpan');

        // Sinkronkan cache dari server (opsional, di sini cukup update lokal)
        localStorage.setItem('wishes_cache', JSON.stringify(next));
        qs('#wishForm')?.reset();
        showToast('Terima kasih, pesan terkirim!');
      } catch (err) {
        // Fallback: simpan lokal bila jaringan/n8n error
        const local = JSON.parse(localStorage.getItem('wishes_offline')||'[]');
        local.push(optimistic);
        localStorage.setItem('wishes_offline', JSON.stringify(local));
        showToast('Pesan disimpan sementara (offline). Akan terkirim saat online.');
      }
    }

    // ====== GALLERY LIGHTBOX ======
    function initLightbox(){
      const imgs = qsa('.gallery-img');
      const box = qs('#lightbox');
      const img = qs('#lightboxImg');
      const close = qs('#lightboxClose');
      imgs.forEach(i=> i.addEventListener('click',()=>{ img.src = i.src; box.classList.remove('hidden'); }))
      close.addEventListener('click',()=> box.classList.add('hidden'));
      box.addEventListener('click', (e)=>{ if(e.target===box) box.classList.add('hidden'); });
    }

    // ====== MUSIC TOGGLE ======
    function initMusicToggle(){
      const btn = qs('#musicToggle');
      const audio = qs('#bgm');
      btn.addEventListener('click', ()=>{
        if(audio.paused){ audio.play().catch(()=>{}); btn.textContent = '♬ Pause'; }
        else { audio.pause(); btn.textContent = '♬ Play'; }
      })
    }

    // ====== BOOT ======
    window.addEventListener('DOMContentLoaded', ()=>{
      applyTexts();
      initLightbox();
      initMusicToggle();
      loadWishes();
      startCountdown();

      // Tombol open selalu siap (tidak menunggu preload)
      const openBtn = qs('#openBtn');
      openBtn.addEventListener('click', handleOpen);

      // Preload aset tanpa menghalangi interaksi (race dengan timeout)
      const preloadTimeout = new Promise(r => setTimeout(r, 3500));
      Promise.race([preloadAssets(config.assetsToPreload), preloadTimeout]).catch(()=>{});

      // Form wishes
      qs('#wishForm').addEventListener('submit', submitWish);

      // Add to calendar
      qs('#addCalendarBtn').addEventListener('click', downloadICS);
    })

    function copyRek(id) {
      const text = document.getElementById(id).innerText;
      navigator.clipboard.writeText(text).then(() => {
        showToast("Nomor rekening berhasil disalin: " + text);
      });
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.remove("opacity-0");
      toast.classList.add("opacity-100");

      setTimeout(() => {
        toast.classList.remove("opacity-100");
        toast.classList.add("opacity-0");
      }, 2000); // hilang setelah 2 detik
    }

  </script>
</body>
</html>